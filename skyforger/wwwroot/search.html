<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Skyforger Search</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<body>
<script>
    var urlvars = getUrlVars();
    var manacolor = urlvars["manacolor"];
    var manaclass = urlvars["manaclass"];
    var level = urlvars["level"];
    var school = urlvars["school"];
    var subschool = urlvars["subschool"];
    var descriptor = urlvars["descriptor"];

    const Http = new XMLHttpRequest();
    const url = `http://localhost:5000/spells/find/advanced?manacolor=${manacolor}&manaclass=${manaclass}&level=${level}&school=${school}&subschool=${subschool}&descriptor=${descriptor}`;
    Http.open("GET", url);
    Http.send();

    Http.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            var json = JSON.parse(Http.responseText);
            console.log(json);
            json.forEach(obj => {
                createListItem(obj);
            })
        }

    };

    function getUrlVars() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
            vars[key] = value;
        });
        return vars;
    }

    function createListItem(obj) {
        var mana = [];
        

        var table = document.getElementById("spelltable");
        table.insertRow().insertCell().innerHTML = `
<table class="table">
    <tbody>
        <tr class="spellItem">
            <td>
                <div class="clear"></div>
                <div class="cardInfo">
                    <span style="font-size: 18px; text-decoration: underline"><b><a href="${obj["SpellUri"]}">${obj["Name"]}</a></b></span><br>
                    <span class="typeLine" class="spellschool" style="text-transform:capitalize;">
                        School: ${obj["SchoolRaw"]}
                    </span><br>
                    <span class="typeLine" class="spellmana" style="text-transform:capitalize;">
                        Level: ${obj["ManaDescription"]} ${obj["SpellLevel"]}
                    </span>
                    <br><br>
                    <div class="rulesText">
                        <p>${obj["Description"]}</p></div>
                </div>
            </td>
        </tr>
    </tbody>
</table>`;
    }
</script>

<table id="spelltable" class="table" cellpadding="0" cellspacing="0">
</table>
</body>
</html>